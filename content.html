<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>文案管理 - 标题与文案库</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 自定义样式 -->
    <link rel="stylesheet" href="assets/styles.css" />

    <!-- GSAP 动画 -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

    <!-- Supabase JS SDK（必须先加载） -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Supabase 配置 -->
    <script src="assets/supabase.js"></script>

    <!-- 分类识别（可选） -->
    <script src="assets/classifier.js"></script>

    <!-- 文案管理主逻辑（复用标题页交互） -->
    <script src="assets/app-title.js"></script>
  </head>
  <body class="bg-page" data-page="content">
    <div class="wrap">
      <!-- 顶部栏 -->
      <header class="topbar">
        <!-- 左：Logo + 主标题（蓝色） -->
        <div class="topbar-left">
          <div class="logo-dot"></div>
          <div class="ml-2">
            <div class="topbar-title">标题与文案管理系统</div>
          </div>
        </div>

        <!-- 中：标题 / 文案 Tab -->
        <div class="topbar-center">
          <button
            class="nav-tab"
            onclick="window.location.href='title.html'"
          >
            标题
          </button>
          <button class="nav-tab nav-tab-active">文案</button>
        </div>

        <!-- 右：Supabase 状态 -->
        <div class="topbar-right">
          <span id="supabaseStatus" class="pill-muted text-xs">
            Supabase 在线
          </span>
        </div>
      </header>

      <main class="layout">
        <!-- 左侧分类面板 -->
        <aside class="panel w-full md:w-64 md:flex-shrink-0">
          <!-- 按钮行：新增 / 删除 / 排序 -->
          <div class="flex items-center justify-end mb-3">
            <div class="flex gap-2">
              <button id="btnAddCategory" class="function-btn ghost text-xs">
                新增分类
              </button>
              <button
                id="btnDeleteCategory"
                class="function-btn ghost text-xs"
              >
                删除分类
              </button>
              <button id="btnSortCategory" class="function-btn ghost text-xs">
                排序
              </button>
            </div>
          </div>

          <!-- 手机端：分类下拉触发按钮（桌面端隐藏） -->
          <div id="mobileCategoryWrapper" class="md:hidden mb-2">
            <button
              id="mobileCategoryToggle"
              type="button"
              class="function-btn ghost w-full flex items-center justify-between"
            >
              <span id="mobileCategoryLabel">全部</span>
              <span class="text-xs text-gray-600">分类 ▾</span>
            </button>
          </div>

          <!-- 共用一份分类列表：桌面直接显示，手机端通过 JS 控制显示/隐藏 -->
          <ul id="categoryList" class="category-list"></ul>
        </aside>

        <!-- 右侧主内容 -->
        <section class="flex-1 min-w-0 flex flex-col gap-3">
          <!-- 工具栏 -->
          <div class="panel">
            <div class="toolbar flex items-center gap-3 flex-wrap mb-2">
              <!-- 搜索输入 + 清除按钮 -->
              <div class="search-wrapper">
                <input
                  id="searchInput"
                  type="text"
                  placeholder="搜索文案关键词"
                  class="field-input search-input"
                />
                <button
                  id="btnClearSearch"
                  type="button"
                  class="function-btn search-clear-btn text-xs"
                >
                  清除
                </button>
              </div>

              <select id="filterScene" class="field-input filter-select">
                <option value="">场景（全部）</option>
                <option value="港迪城堡">港迪城堡</option>
                <option value="烟花">烟花</option>
                <option value="夜景">夜景</option>
                <option value="香港街拍">香港街拍</option>
              </select>
            </div>

            <!-- 按钮工具区 -->
            <div class="flex flex-wrap items-center gap-2 mt-1">
              <button
                id="btnNewTitle"
                class="function-btn"
                onclick="openTitleModal()"
              >
                新增文案
              </button>
              <button
                id="btnBatchImport"
                class="function-btn ghost"
                onclick="openImportModal()"
              >
                批量导入
              </button>

              <div
                class="extra-actions flex flex-wrap items-center gap-2 ml-auto"
              >
                <button id="btnClearAll" class="function-btn ghost">
                  清空全部
                </button>
                <button id="btnSettings" class="function-btn ghost">
                  设置页面
                </button>
                <button id="btnSaveCloud" class="function-btn ghost">
                  保存云端
                </button>
                <button id="btnLoadCloud" class="function-btn ghost">
                  加载云端
                </button>
                <button id="btnManagePage" class="function-btn ghost">
                  管理页面
                </button>
              </div>
            </div>
          </div>

          <!-- 桌面表格：仅在 md 及以上设备显示 -->
          <div class="panel hidden md:block">
            <table class="basic-table w-full">
              <thead>
                <tr>
                  <th class="w-12">#</th>
                  <th class="text-left">文案</th>
                  <th class="w-28 text-left">主分类</th>
                  <th class="w-40 text-center">操作</th>
                </tr>
              </thead>
              <tbody id="titleTableBody"></tbody>
            </table>
          </div>

          <!-- 移动端卡片列表：仅在小屏显示 -->
          <div class="md:hidden flex flex-col gap-2" id="mobileList"></div>
        </section>
      </main>

      <!-- 云端快照弹出层 -->
      <div id="cloudHistoryPanel" class="cloud-history-panel hidden"></div>

      <!-- 标题弹窗 -->
      <div id="titleModal" class="modal-backdrop hidden">
        <div class="modal">
          <div class="modal-header">
            <div id="titleModalTitle" class="modal-title">新增文案</div>
            <button id="btnCloseModal" class="icon-btn" aria-label="关闭">
              ×
            </button>
          </div>
          <div class="modal-body space-y-3">
            <div class="form-group">
              <label class="field-label">文案内容</label>
              <textarea
                id="titleInput"
                class="field-input"
                rows="3"
                placeholder="输入文案"
              ></textarea>
            </div>

            <div class="form-group">
              <label class="field-label">主分类</label>
              <select id="categorySelect" class="field-input">
                <option value="">选择分类</option>
              </select>
            </div>

            <div class="form-group">
              <label class="field-label">内容类型（可选）</label>
              <input
                id="typeInput"
                class="field-input"
                type="text"
                placeholder="例如：文案类型"
              />
            </div>

            <div class="form-group">
              <label class="field-label">场景标签（可多选）</label>
              <div id="sceneTags" class="tag-list"></div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="btnSaveTitle" class="function-btn">保存文案</button>
            <button id="btnCancelModal" class="function-btn ghost">取消</button>
          </div>
        </div>
      </div>

      <!-- 批量导入弹窗 -->
      <div id="importModal" class="modal-backdrop hidden">
        <div class="modal large">
          <div class="modal-header">
            <div class="modal-title">批量导入文案</div>
            <button id="btnCloseImportModal" class="icon-btn" aria-label="关闭">
              ×
            </button>
          </div>
          <div class="modal-body space-y-3">
            <div class="form-group">
              <label class="field-label">JSON 数组（示例：[{"text":"xxx"}]）</label>
              <textarea
                id="importInput"
                class="field-input"
                rows="8"
                placeholder='["文案1","文案2"] 或 [{"text":"文案","main_category":"分类"}]'
              ></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button id="btnConfirmImport" class="function-btn">导入</button>
            <button id="btnCancelImport" class="function-btn ghost">取消</button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
