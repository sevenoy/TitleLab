<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>标题管理 - 标题与文案库</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="标题管理" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="manifest" href="manifest.webmanifest" />

    

    <!-- 自定义样式 -->
    <link rel="stylesheet" href="assets/styles.css" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon/icon-192.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon/icon-512.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="icon/icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="icon/icon-512.png" />

    <!-- GSAP 动画 -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

    <!-- Supabase JS SDK（必须先加载） -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Supabase 配置 -->
    <script src="assets/supabase.js"></script>

    <!-- 分类识别（可选） -->
    <script src="assets/classifier.js"></script>

    <!-- 标题管理主逻辑 -->
    <script src="assets/app-title.js"></script>
    <script src="assets/pwa.js"></script>
  </head>

  <body class="bg-page">
    <div class="wrap">
      <!-- 顶部栏 -->
      <header class="topbar">
        <!-- 左：Logo + 主标题（蓝色） -->
        <div class="topbar-left">
          <div class="logo-dot"></div>
          <div class="ml-2">
            <div class="topbar-title">标题管理</div>
          </div>
        </div>

        <!-- 中：标题 / 文案 Tab -->
        <div class="topbar-center">
          <button class="nav-tab nav-tab-active">标题</button>
          <button class="nav-tab" onclick="window.location.href='content.html'">文案</button>
        </div>

        <!-- 右：Supabase 状态 -->
        <div class="topbar-right">
          <span id="currentUserName" class="user-badge text-xs"></span>
          <button id="btnLogout" class="function-btn ghost text-xs btn-compact">退出</button>
          <button id="btnLoginHeader" class="function-btn ghost text-xs hidden">登陆</button>
        </div>
      </header>

      <main class="layout">
        <!-- 左侧分类面板 -->
        <aside class="panel w-full md:w-64 md:flex-shrink-0">
          <!-- 按钮行：新增 / 删除 / 排序 -->
          <div class="flex items-center justify-end mb-3">
            <div class="flex gap-2">
              <button id="btnAddCategory" class="function-btn ghost text-xs">
                新增分类
              </button>
              <button
                id="btnDeleteCategory"
                class="function-btn ghost text-xs"
              >
                删除分类
              </button>
              <button id="btnSortCategory" class="function-btn ghost text-xs">
                排序
              </button>
            </div>
          </div>

          <!-- 手机端：分类下拉触发按钮（桌面端隐藏） -->
          <div id="mobileCategoryWrapper" class="md:hidden mb-2">
            <button
              id="mobileCategoryToggle"
              type="button"
              class="function-btn ghost w-full flex items-center justify-between"
            >
              <span id="mobileCategoryLabel">全部</span>
              <span class="text-xs text-gray-600">分类 ▾</span>
            </button>
          </div>

          <!-- 共用一份分类列表：桌面直接显示，手机端通过 JS 控制显示/隐藏 -->
          <ul id="categoryList" class="category-list"></ul>
        </aside>

        <!-- 右侧主内容 -->
        <section class="flex-1 min-w-0 flex flex-col gap-3">
          <!-- 工具栏 -->
          <div class="panel">
            <div class="toolbar flex items-center gap-3 flex-wrap mb-2">
              <!-- 搜索输入 + 清除按钮 -->
              <div class="search-wrapper">
                <input
                  id="searchInput"
                  type="text"
                  placeholder="搜索标题关键词"
                  class="field-input search-input"
                />
                <button
                  id="btnClearSearch"
                  type="button"
                  class="function-btn search-clear-btn text-xs"
                >
                  清除
                </button>
              </div>

              <select id="filterScene" class="field-input filter-select">
                <option value="">账号分类</option>
                <option value="港迪城堡">港迪城堡</option>
                <option value="烟花">烟花</option>
                <option value="夜景">夜景</option>
                <option value="香港街拍">香港街拍</option>
              </select>
            </div>

            <!-- 按钮工具区 -->
            <div class="toolbar-actions mt-1">
              <button id="btnNewTitle" class="function-btn" onclick="openTitleModal()">新增标题</button>
              <button id="btnBatchImport" class="function-btn ghost text-xs" onclick="openImportModal()">批量导入</button>
              <button id="btnClearAll" class="function-btn ghost text-xs">清空全部</button>
              <button id="btnSettings" class="function-btn ghost text-xs">设置页面</button>
              <button id="btnSaveCloud" class="function-btn ghost">保存云端</button>
              <button id="btnLoadCloud" class="function-btn ghost">加载云端</button>
              <button id="btnManagePage" class="function-btn ghost" onclick="window.location.href='admin-center.html'">管理页面</button>
            </div>
          </div>

          <!-- 桌面表格：仅在 md 及以上设备显示 -->
          <div class="panel hidden md:block">
            <table class="basic-table w-full">
              <thead>
                <tr>
                  <th class="w-12 text-left">#</th>
                  <th class="text-left">标题</th>
                  <th class="w-28 text-left">主分类</th>
                  <th class="w-40 text-center">操作</th>
                </tr>
              </thead>
              <tbody id="titleTableBody"></tbody>
            </table>
          </div>

          <!-- 移动端卡片列表：仅在小屏显示 -->
          <div class="md:hidden flex flex-col gap-2" id="mobileList"></div>
        </section>
      </main>

      <!-- 云端快照弹出层 -->
      <div id="cloudHistoryPanel" class="cloud-history-panel hidden"></div>
      <div id="cloudLabelModal" class="modal-backdrop hidden">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">保存云端快照</div>
            <button id="btnCloseCloudLabel" class="icon-btn" aria-label="关闭">×</button>
          </div>
          <div class="modal-body">
            <label class="field-label">快照备注名</label>
            <input id="cloudLabelInput" type="text" class="field-input" placeholder="例如：11月中旬版本" />
          </div>
          <div class="modal-footer">
            <button id="btnCancelCloudLabel" class="function-btn ghost">取消</button>
            <button id="btnSaveCloudLabel" class="function-btn">保存</button>
          </div>
        </div>
      </div>
      <div id="clearConfirmModal" class="modal-backdrop hidden">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">清空全部标题</div>
            <button id="btnCloseClearConfirm" class="icon-btn" aria-label="关闭">×</button>
          </div>
          <div class="modal-body">
            <div class="text-sm">确定清空全部标题？此操作不可恢复。</div>
          </div>
          <div class="modal-footer">
            <button id="btnCancelClear" class="function-btn ghost">取消</button>
            <button id="btnConfirmClear" class="function-btn">清空</button>
          </div>
        </div>
      </div>
      <div id="addCategoryModal" class="modal-backdrop hidden">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">新增分类</div>
            <button id="btnCloseAddCategory" class="icon-btn" aria-label="关闭">×</button>
          </div>
          <div class="modal-body">
            <label class="field-label">分类名称</label>
            <input id="addCategoryInput" type="text" class="field-input" placeholder="请输入新的分类名称" />
          </div>
          <div class="modal-footer">
            <button id="btnCancelAddCategory" class="function-btn ghost">取消</button>
            <button id="btnConfirmAddCategory" class="function-btn">保存</button>
          </div>
        </div>
      </div>
      <div id="deleteCategoryModal" class="modal-backdrop hidden">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">删除分类</div>
            <button id="btnCloseDeleteCategory" class="icon-btn" aria-label="关闭">×</button>
          </div>
          <div class="modal-body">
            <div class="text-sm">确定删除分类「<span id="deleteCategoryName"></span>」？</div>
          </div>
          <div class="modal-footer">
            <button id="btnCancelDeleteCategory" class="function-btn ghost">取消</button>
            <button id="btnConfirmDeleteCategory" class="function-btn">删除</button>
          </div>
        </div>
      </div>
      <div id="renameCategoryModal" class="modal-backdrop hidden">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">修改分类名称</div>
            <button id="btnCloseRenameCategory" class="icon-btn" aria-label="关闭">×</button>
          </div>
          <div class="modal-body">
            <label class="field-label">分类名称</label>
            <input id="renameCategoryInput" type="text" class="field-input" placeholder="请输入新的分类名称" />
          </div>
          <div class="modal-footer">
            <button id="btnCancelRenameCategory" class="function-btn ghost">取消</button>
            <button id="btnConfirmRenameCategory" class="function-btn">保存</button>
          </div>
        </div>
      </div>

      <!-- 标题弹窗 -->
      <div id="titleModal" class="modal-backdrop hidden">
        <div class="modal">
          <div class="modal-header">
            <div id="titleModalTitle" class="modal-title">新增标题</div>
            <button id="btnCloseModal" class="icon-btn" aria-label="关闭">
              ×
            </button>
          </div>

          <div class="modal-body space-y-3">
            <div>
              <label class="field-label">标题内容</label>
              <textarea
                id="fieldText"
                class="field-input"
                rows="3"
                placeholder="请输入标题"
              ></textarea>
            </div>

            <div class="flex flex-wrap gap-3">
              <div class="flex-1 min-w-[120px]">
                <label class="field-label">主分类</label>
                <select id="fieldMainCategory" class="field-input"></select>
              </div>

              <div class="flex-1 min-w-[120px]">
                <label class="field-label">账号分类选择</label>
                <select id="fieldContentType" class="field-input">
                  <option value="">账号分类</option>
                  <option value="港迪城堡">港迪城堡</option>
                  <option value="烟花">烟花</option>
                  <option value="夜景">夜景</option>
                  <option value="香港街拍">香港街拍</option>
                </select>
              </div>
            </div>

            <div>
              <label class="field-label">场景标签（可选，多项用逗号分隔）</label>
              <input
                id="fieldSceneTags"
                type="text"
                class="field-input"
                placeholder="例如：港迪城堡, 烟花, 夜景"
              />
            </div>
          </div>

          <div class="modal-footer">
            <button id="btnCancelModal" class="function-btn ghost">
              取消
            </button>
            <button id="btnSaveTitle" class="function-btn">保存</button>
          </div>
        </div>
      </div>
      <div id="cloudLoadConfirmModalTitle" class="modal-backdrop hidden">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">加载云端快照</div>
            <button id="btnCloseCloudLoadConfirmTitle" class="icon-btn" aria-label="关闭">×</button>
          </div>
          <div class="modal-body">
            <div class="text-sm">确定使用此快照覆盖当前数据？</div>
          </div>
          <div class="modal-footer">
            <button id="btnCancelCloudLoadTitle" class="function-btn ghost">取消</button>
            <button id="btnConfirmCloudLoadTitle" class="function-btn">确定</button>
          </div>
        </div>
      </div>
      <div id="deleteTitleModal" class="modal-backdrop hidden">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">删除标题</div>
            <button id="btnCloseDeleteTitle" class="icon-btn" aria-label="关闭">×</button>
          </div>
          <div class="modal-body">
            <div class="text-sm">确定删除该标题：</div>
            <div class="text-xs mt-2" id="deleteTitlePreview"></div>
          </div>
          <div class="modal-footer">
            <button id="btnCancelDeleteTitle" class="function-btn ghost">取消</button>
            <button id="btnConfirmDeleteTitle" class="function-btn">删除</button>
          </div>
        </div>
      </div>

      <!-- 批量导入弹窗 -->
      <div id="importModal" class="modal-backdrop hidden">
        <div class="modal modal-lg">
          <div class="modal-header">
            <div class="modal-title">批量导入标题</div>
            <button id="btnCloseImport" class="icon-btn" aria-label="关闭">
              ×
            </button>
          </div>

          <div class="modal-body grid gap-3 md:grid-cols-2">
            <div class="space-y-2">
              <div class="flex items-center gap-2">
                <div class="flex-1">
                  <label class="field-label">导入到分类</label>
                  <select id="importCategorySelect" class="field-input"></select>
                </div>
                <div class="flex-1">
                  <label class="field-label">账号分类</label>
                  <select id="importAccountCategorySelect" class="field-input">
                    <option value="">账号分类</option>
                    <option value="港迪城堡">港迪城堡</option>
                    <option value="烟花">烟花</option>
                    <option value="夜景">夜景</option>
                    <option value="香港街拍">香港街拍</option>
                  </select>
                </div>
              </div>
              <label class="field-label">多行标题（每行一条）</label>
              <textarea
                id="importRawInput"
                class="field-input"
                rows="12"
                placeholder="粘贴多行标题，每行一条"
              ></textarea>
            </div>
            <div class="space-y-2 import-preview-wrapper">
              <label class="field-label">识别预览</label>
              <div id="importPreview" class="preview-box"></div>
            </div>
          </div>

          <div class="modal-footer">
            <button id="btnCancelImport" class="function-btn ghost">
              取消
            </button>
            <button id="btnRunImport" class="function-btn">
              识别并导入
            </button>
          </div>
        </div>
      </div>

      <!-- Toast -->
      <div id="toast" class="toast hidden"></div>
    </div>
    <!-- 页面加载后立即隐藏所有模态框 -->
    <script>
      (function() {
        let isInitializing = true;
        function hideAllModals() {
          // 只在初始化阶段强制隐藏，避免干扰正常的模态框显示
          if (!isInitializing) return;
          
          // 强制隐藏所有模态框
          const allModals = document.querySelectorAll('.modal-backdrop');
          allModals.forEach(modal => {
            // 只处理有hidden类的模态框，避免干扰正常显示的模态框
            if (modal.classList.contains('hidden')) {
              modal.style.display = 'none';
              modal.style.visibility = 'hidden';
              modal.style.opacity = '0';
              modal.style.pointerEvents = 'none';
              modal.style.zIndex = '-1';
            }
          });
          // 隐藏云端快照面板
          const cloudPanel = document.getElementById('cloudHistoryPanel');
          if (cloudPanel && cloudPanel.classList.contains('hidden')) {
            cloudPanel.style.display = 'none';
            cloudPanel.style.visibility = 'hidden';
          }
        }
        // 立即执行（DOM可能还没加载完，但也要尝试）
        hideAllModals();
        // DOMContentLoaded时再执行一次
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', function() {
            hideAllModals();
            // 初始化完成后，允许正常的模态框显示
            setTimeout(() => { isInitializing = false; }, 1000);
          });
        } else {
          hideAllModals();
          setTimeout(() => { isInitializing = false; }, 1000);
        }
        // window.onload时再执行一次（确保万无一失）
        window.addEventListener('load', function() {
          hideAllModals();
          setTimeout(() => { isInitializing = false; }, 500);
        });
      })();
    </script>
  </body>
</html>
