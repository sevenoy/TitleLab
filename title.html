<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>标题管理 - 标题与文案库</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 自定义样式 -->
    <link rel="stylesheet" href="assets/styles.css" />

    <!-- GSAP 动画 -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

    <!-- Supabase JS SDK（必须先加载） -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Supabase 配置 -->
    <script src="assets/supabase.js"></script>

    <!-- 分类识别（可选） -->
    <script src="assets/classifier.js"></script>

    <!-- 标题管理主逻辑 -->
    <script src="assets/app-title.js"></script>
  </head>

  <body class="bg-page">
    <div class="wrap">
      <!-- 顶部栏 -->
      <header class="topbar">
        <!-- 左：Logo + 主标题（蓝色） -->
        <div class="topbar-left">
          <div class="logo-dot"></div>
          <div class="ml-2">
            <div class="topbar-title">标题与文案管理系统</div>
          </div>
        </div>

        <!-- 中：标题 / 文案 Tab（同页切换，避免跨页跳转） -->
        <div class="topbar-center">
          <button class="nav-tab nav-tab-active" data-target="title">标题</button>
          <button class="nav-tab" data-target="content">文案</button>
        </div>

        <!-- 右：Supabase 状态 -->
        <div class="topbar-right">
          <span id="supabaseStatus" class="pill-muted text-xs">
            Supabase 在线
          </span>
        </div>
      </header>

      <main id="titleSection" class="layout">
        <!-- 左侧分类面板 -->
        <aside class="panel w-full md:w-64 md:flex-shrink-0">
          <!-- 按钮行：新增 / 删除 / 排序 -->
          <div class="flex items-center justify-end mb-3">
            <div class="flex gap-2">
              <button id="btnAddCategory" class="function-btn ghost text-xs">
                新增分类
              </button>
              <button
                id="btnDeleteCategory"
                class="function-btn ghost text-xs"
              >
                删除分类
              </button>
              <button id="btnSortCategory" class="function-btn ghost text-xs">
                排序
              </button>
            </div>
          </div>

          <!-- 手机端：分类下拉触发按钮（桌面端隐藏） -->
          <div id="mobileCategoryWrapper" class="md:hidden mb-2">
            <button
              id="mobileCategoryToggle"
              type="button"
              class="function-btn ghost w-full flex items-center justify-between"
            >
              <span id="mobileCategoryLabel">全部</span>
              <span class="text-xs text-gray-600">分类 ▾</span>
            </button>
          </div>

          <!-- 共用一份分类列表：桌面直接显示，手机端通过 JS 控制显示/隐藏 -->
          <ul id="categoryList" class="category-list"></ul>
        </aside>

        <!-- 右侧主内容 -->
        <section class="flex-1 min-w-0 flex flex-col gap-3">
          <!-- 工具栏 -->
          <div class="panel">
            <div class="toolbar flex items-center gap-3 flex-wrap mb-2">
              <!-- 搜索输入 + 清除按钮 -->
              <div class="search-wrapper">
                <input
                  id="searchInput"
                  type="text"
                  placeholder="搜索标题关键词"
                  class="field-input search-input"
                />
                <button
                  id="btnClearSearch"
                  type="button"
                  class="function-btn search-clear-btn text-xs"
                >
                  清除
                </button>
              </div>

              <select id="filterScene" class="field-input filter-select">
                <option value="">场景（全部）</option>
                <option value="港迪城堡">港迪城堡</option>
                <option value="烟花">烟花</option>
                <option value="夜景">夜景</option>
                <option value="香港街拍">香港街拍</option>
              </select>
            </div>

            <!-- 按钮工具区 -->
            <div class="flex flex-wrap items-center gap-2 mt-1">
              <button
                id="btnNewTitle"
                class="function-btn"
                onclick="openTitleModal()"
              >
                新增标题
              </button>
              <button
                id="btnBatchImport"
                class="function-btn ghost"
                onclick="openImportModal()"
              >
                批量导入
              </button>

              <div
                class="extra-actions flex flex-wrap items-center gap-2 ml-auto"
              >
                <button id="btnClearAll" class="function-btn ghost">
                  清空全部
                </button>
                <button id="btnSettings" class="function-btn ghost">
                  设置页面
                </button>
                <button id="btnSaveCloud" class="function-btn ghost">
                  保存云端
                </button>
                <button id="btnLoadCloud" class="function-btn ghost">
                  加载云端
                </button>
                <button id="btnManagePage" class="function-btn ghost">
                  管理页面
                </button>
              </div>
            </div>
          </div>

          <!-- 桌面表格：仅在 md 及以上设备显示 -->
          <div class="panel hidden md:block">
            <table class="basic-table w-full">
              <thead>
                <tr>
                  <th class="w-12">#</th>
                  <th class="text-left">标题</th>
                  <th class="w-28 text-left">主分类</th>
                  <th class="w-40 text-center">操作</th>
                </tr>
              </thead>
              <tbody id="titleTableBody"></tbody>
            </table>
          </div>

          <!-- 移动端卡片列表：仅在小屏显示 -->
          <div class="md:hidden flex flex-col gap-2" id="mobileList"></div>
        </section>
      </main>

      <!-- 文案管理区域（与标题同页 tab 切换） -->
      <main id="contentSection" class="layout hidden">
        <aside class="sidebar panel">
          <div class="sidebar-header">
            <h2 class="panel-title">分类</h2>
            <button class="function-btn ghost text-xs">新增分类</button>
          </div>
          <ul id="contentCategoryList" class="category-list"></ul>
        </aside>

        <section class="panel content-area">
          <div class="toolbar">
            <div class="toolbar-left">
              <input
                type="search"
                class="input"
                placeholder="搜索文案 / 标题"
              />
            </div>
            <div class="toolbar-center">
              <!-- 未来：语气、平台、场景等筛选 -->
            </div>
            <div class="toolbar-right">
              <button class="function-btn primary">新增文案</button>
            </div>
          </div>

          <div class="table-wrap desktop-only">
            <table class="data-table zebra">
              <thead>
                <tr>
                  <th class="w-10">#</th>
                  <th class="w-40">文案标题</th>
                  <th>正文摘要</th>
                  <th class="w-28">主分类</th>
                  <th class="w-28">内容类型</th>
                  <th class="w-32">操作</th>
                </tr>
              </thead>
              <tbody id="contentTableBody"></tbody>
            </table>
          </div>

          <div id="contentMobileList" class="mobile-only space-y-3"></div>
        </section>
      </main>

      <!-- 云端快照弹出层 -->
      <div id="cloudHistoryPanel" class="cloud-history-panel hidden"></div>

      <!-- 标题弹窗 -->
      <div id="titleModal" class="modal-backdrop hidden">
        <div class="modal">
          <div class="modal-header">
            <div id="titleModalTitle" class="modal-title">新增标题</div>
            <button id="btnCloseModal" class="icon-btn" aria-label="关闭">
              ×
            </button>
          </div>

          <div class="modal-body space-y-3">
            <div>
              <label class="field-label">标题内容</label>
              <textarea
                id="fieldText"
                class="field-input"
                rows="3"
                placeholder="请输入标题"
              ></textarea>
            </div>

            <div class="flex flex-wrap gap-3">
              <div class="flex-1 min-w-[120px]">
                <label class="field-label">主分类</label>
                <select id="fieldMainCategory" class="field-input"></select>
              </div>

              <div class="flex-1 min-w-[120px]">
                <label class="field-label">内容类型</label>
                <select id="fieldContentType" class="field-input">
                  <option value="">自动识别</option>
                  <option value="展示">出片展示</option>
                  <option value="攻略">攻略 / 机位</option>
                  <option value="服务">服务推荐</option>
                  <option value="节日">节日主题</option>
                </select>
              </div>
            </div>

            <div>
              <label class="field-label">场景标签（可选，多项用逗号分隔）</label>
              <input
                id="fieldSceneTags"
                type="text"
                class="field-input"
                placeholder="例如：港迪城堡, 烟花, 夜景"
              />
            </div>
          </div>

          <div class="modal-footer">
            <button id="btnCancelModal" class="function-btn ghost">
              取消
            </button>
            <button id="btnSaveTitle" class="function-btn">保存</button>
          </div>
        </div>
      </div>

      <!-- 批量导入弹窗 -->
      <div id="importModal" class="modal-backdrop hidden">
        <div class="modal modal-lg">
          <div class="modal-header">
            <div class="modal-title">批量导入标题</div>
            <button id="btnCloseImport" class="icon-btn" aria-label="关闭">
              ×
            </button>
          </div>

          <div class="modal-body grid gap-3 md:grid-cols-2">
            <div class="space-y-2">
              <label class="field-label">多行标题（每行一条）</label>
              <textarea
                id="importRawInput"
                class="field-input"
                rows="12"
                placeholder="粘贴多行标题，每行一条"
              ></textarea>
            </div>
            <div class="space-y-2 import-preview-wrapper">
              <label class="field-label">识别预览</label>
              <div id="importPreview" class="preview-box"></div>
            </div>
          </div>

          <div class="modal-footer">
            <button id="btnCancelImport" class="function-btn ghost">
              取消
            </button>
            <button id="btnRunImport" class="function-btn">
              识别并导入
            </button>
          </div>
        </div>
      </div>

      <!-- Toast -->
      <div id="toast" class="toast hidden"></div>
    </div>

    <!-- 站内 tab 切换：无跳转在同页展示标题与文案 -->
    <script>
      const tabButtons = document.querySelectorAll('.nav-tab');
      const sections = {
        title: document.getElementById('titleSection'),
        content: document.getElementById('contentSection'),
      };

      function switchTab(target) {
        tabButtons.forEach((btn) => {
          const isActive = btn.dataset.target === target;
          btn.classList.toggle('nav-tab-active', isActive);
        });

        Object.entries(sections).forEach(([key, el]) => {
          el.classList.toggle('hidden', key !== target);
        });
      }

      tabButtons.forEach((btn) => {
        btn.addEventListener('click', () => switchTab(btn.dataset.target));
      });
    </script>
  </body>
</html>
